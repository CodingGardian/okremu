
<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="emustyle.css">
        <title>okrEMU</title>
    </head>
    <body>
        <div class="draghint hidden screen" id="draghint">
            <input type="file" id="chooser" class="chooser" disabled/>
            <div class="dragtext">
                <h1>Launching...</h1>
            </div>
        </div>
        <div id="loading" class="message screen"><h1>Loading...</h1></div>
        <div id="error" class="message hidden screen">
            <h1>Error</h1>
            <div id="clear-save" class="hidden">
                <p>This could be caused by a corrupted save file. This button
                    will allow you to reset your save. Sadly, you will not be able to
                    recover your save.</p>
                <button onclick="removeSave(); reset()">Delete save for this game</button>
            </div>
        </div>
        <div id="overlay" class="overlay"></div>
        <div class="menu hidden screen" id="menu">
            <input type="file" id="savechooser" class="chooser"/>
            <div class="options">
                <h1>Your game is paused.</h1>
                <button onclick="resume()">resume</button>
                <button onclick="reset()">reset</button>
                <button onclick="save()">save game</button>
                <button onclick="load()">load save</button>
                <button onclick="removeSave(); reset()">delete save</button>
                <button id="mute" onclick="mute()">mute</button>
            </div>
            <div>
                <h1>Controls:</h1>
                <div>A button = <button id='a' onclick='callingButton = this; rebind();'></button></div>
                <div>B button = <button id='b' onclick='callingButton = this; rebind();'></button></div>
                <div>X button = <button id='x' onclick='callingButton = this; rebind();'></button></div>
                <div>Y button = <button id='y' onclick='callingButton = this; rebind();'></button></div>
                <div>L button = <button id='l' onclick='callingButton = this; rebind();'></button></div>
                <div>R button = <button id='r' onclick='callingButton = this; rebind();'></button></div>
                <div>Start button = <button id='start' onclick='callingButton = this; rebind();'></button></div>
                <div>Select button = <button id='select' onclick='callingButton = this; rebind();'></button></div>
                <div>Up button = <button id='up' onclick='callingButton = this; rebind();'></button></div>
                <div>Down button = <button id='down' onclick='callingButton = this; rebind();'></button></div>
                <div>Left button = <button id='left' onclick='callingButton = this; rebind();'></button></div>
                <div>Right button = <button id='right' onclick='callingButton = this; rebind();'></button></div>
                <div>Quick save = <button id='qs' onclick='callingButton = this; rebind();'></button></div>
                <div>Quick load = <button id='ql' onclick='callingButton = this; rebind();'></button></div>
            </div>
            <div>
                <h1>Core Info:</h1>
                <pre id="core-name"></pre>
                <pre id="system-info"></pre>
                <pre id="av-info"></pre>
            </div>
        </div>
        <script src="scr1.js"></script>
        <script src="scr2.js"></script>
        <script src="scr3.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>
        <script>System.import('./index.coffee!')</script>
        <script>
            window.addEventListener('keydown', window.keydownlistener);
window.addEventListener('keyup', window.keyuplistener);
            async function execution(id, ext){
                var blob,
                    fileInput = document.getElementById('chooser');
                async function setBlobToUrl(url){blob = await fetch(url).then(r => r.blob());}
                await setBlobToUrl('https://oemu1fetcher.herokuapp.com/https://drive.google.com/uc?export=download&id=' + id);
                const dT = new ClipboardEvent('').clipboardData || new DataTransfer();
                dT.items.add(new File([blob], 'game.' + ext));
                fileInput.files = dT.files;
                fileInput.dispatchEvent(new Event('change'));
            }
            var id = localStorage.getItem('gameid'),
                extension = localStorage.getItem('gameext'),
                dev = localStorage.getItem('devdata');

            if(dev === 'launcher.jsnes'){
                document.location.href = 'dev/jsnes/jsnes.html';
            }
            execution(id, extension);
        </script>
    </body>
</html>
